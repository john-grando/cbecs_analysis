
\section{Neural Network Models}
\label{sec:nn_models}
%\addcontentsline{toc}{section}{\nameref{sec:nn_models}}

\subsection{General}
The choice to use neural networks for the final model was multi-faceted.  First, these types of models are very good at capturing complex non-linear interactions.  This appears to be the case with the data set given the failure of lasso models as well as the low percentage of variance capture for the first few dimensions of the principal component and partial least squares analyses.  Note, lasso models were not reported in the previous section due to these issues.  Secondly, neural networks have the ability to select different loss functions.  This is beneficial because it is important to highlight practicality of the results returned.  As the estimated energy consumption grows, it is somewhat acceptable for the error rate to grow proportionally if it results in better fits for the low estimates.  To reflect this reasoning, additional metrics, and loss function, for this set of models were chosen to be the mean absolute percentage error (MAPE) and mean square logarithmic error (MSLE).  These metrics will be evaluated for all models to determine effectiveness.

\subsection{Hyperparameter Training}
In order to select the most optimized set of parameters, some hyperparameter training was performed.  Some standard searches were made, such as varying the dropout rate, regularization, learning rate, and batch size; however, one additional training set was incorporated to highlight the goals of this study.  A series of models were tested which had an incrementally decreasing number of variables, by least importance, in order to test the loss of accuracy.

\subsection{Electricity}
\subsubsection{Summary}
The final selected model consisted of a 5 hidden layers, 1000 hidden layer nodes, a dropout rate of 0.3, no regularization, batch sizes of 150, using the rmsprop() algorithm with a learning rate of 0.0005, and 100 predictors.  As can be seen in the graph below, the number of variables needed to obtain near-peak performance, is much less than the full set.

\begin{figure}[h]
\centering
\includegraphics[width=\textwidth, height=0.25\textheight]{Images/electricity_psf_nn_error.png}
\end{figure}

The final selected model, after re-training, has a MSLE of 0.92 and RMSE of 54696.  Comparing this model ('Full Neural Network') to the previous feature extraction models, which used many more variables, the performance is competitive.  Additionally, the results were then multiplied by their respect gross floor area and then compared to the set of feature extraction models, with the same transformation, in order to evaluate the total consumption prediction error.  Again, it can be seen that this neural network model has shown to be competetive in this manner and, in fact, has a better Rsquared value.

The resdiuals indicate that the variance scales with the response variable; however, since neural network models do not operate on a principle of homoscedacitity, only underlying patterns are of concern. Additionally, the noted error pattern is by design since the loss function (MSLE) allows for higher error in higher consumption projects.  \textit{\hyperref[appendix_nn:electricity:nn_full]{Appendix}}

\begin{figure}[h]
\centering
\includegraphics[width=.49\textwidth, height=0.25\textheight]{Images/electricity_psf_model_summary.png}
\includegraphics[width=0.49\textwidth, height=0.25\textheight]{Images/electricity_psf_model_summary_transformed.png}
\end{figure}


\subsubsection{Variable Selection Summary}
The final model chosen uses 100 variables.  Many of the features within the set have to do with the amount of receptacle equipment within the building as well as major electrical devices (e.g. MRI machines) and essential equipment (e.g. data center servers, refrigeration).  Also, building type identifiers have been included for various categories. \textit{\hyperref[appendix_nn:electricity:nn_full_variables]{Appendix}}

The automated selection process does seem to have included some highly correlated pairs, such as the number of workers per square foot as well as the categorical bin of workers.  This does reduce the number of necessary questions, but it is unclear if both are necessary and/or if they are possibly detrimental.  Also, there are a number of questions that may be automatically known just based on the usage type as some questions do not apply to all buidlings.  It is possible take the steps used in asking questions in the survey in order to build a live form that can automatically parse out the meaningful questions based on building type, which could reduce the need to enter a value for all the selected variables.

%\FloatBarrier
%\newpage
\subsection{Natural Gas}
\subsubsection{Summary}
The final selected model consisted of a 5 hidden layers, 800 hidden layer nodes, a dropout rate of 0.3, no regularization, batch sizes of 150, using the rmsprop() algorithm with a learning rate of 0.0005, and 100 predictors.  As can be seen in the graph below, the number of variables needed to obtain near-peak performance, is much less than the full set. \textit{\hyperref[appendix_nn:natural_gas:nn_full]{Appendix}}

\begin{figure}[h]
\centering
\includegraphics[width=\textwidth, height=0.25\textheight]{Images/natural_gas_psf_nn_error.png}
\end{figure}

The final selected model, after re-training, has a MSLE of 1.42 and RMSE of 61341.  Comparing this model ('Full Neural Network') to the previous feature extraction models, which used many more variables, the performance is actually better (when using RMSE).   \textit{\hyperref[appendix_nn:natural_gas:nn_full_variables]{Appendix}}

\begin{figure}[h]
\centering
\includegraphics[width=.49\textwidth, height=0.25\textheight]{Images/natural_gas_psf_model_summary.png}
\includegraphics[width=0.49\textwidth, height=0.25\textheight]{Images/natural_gas_psf_model_summary_transformed.png}
\end{figure}

\subsubsection{Variable Selection Summary}
This fuel source prediction appears to highly depend on predictor variables that indicate occupancy and length of building operation, such as food service seating capacity, number of cash registers, weekend operation, etc.  Additionally, indicators of commercial cooking are included.  All these selections are unsurprising as natural gas, in the U.S.A, is mainly used for heating energy and food preparation. 

\subsection{Future Work}
While it was determined that some heteroscedacitity would be acceptable, there does appear to be area for improvement.  Additionally, as mentioned at the beginning of this report, the sampling of this data set was stratified to reflect the building population.  However, it is noted that there are some building classes that have greater variance than others.  Therefore, it may be useful to use this stratification as a weighted method, based on \lstinline{PBAPLUS}, in order to try and emphasize accuracy on the most prevalent budiding types. Also, there was not a lot of attention paid to the actual transformations of the predictors given the large quantity of them.  It is possible a better fit can be obtained with more intelligent transformations applied to the features after further analysis.

%\FloatBarrier
%\newpage
%\subsection{District Heat}

%\FloatBarrier
%\newpage
%\subsection{Fuel Oil}